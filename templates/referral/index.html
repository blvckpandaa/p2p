{% extends 'base.html' %}

{% block title %}Oxiri P2P - Реферальная{% endblock %}

{% block content %}
<div class="py-6">
    <div class="flex items-center mb-6">
        <h1 class="text-xl font-bold">Реферальная</h1>
    </div>

    <div class="mb-6">
        <div class="text-base font-semibold mb-2">{{ main_stats|safe }}</div>
        <div class="text-sm text-blue-400">{{ motivation_text|safe }}</div>
    </div>

    <div class="card p-4 mb-6">
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-primary/30 p-3 rounded-lg text-center">
                <div class="text-xs opacity-70 mb-1">Приглашено друзей</div>
                <div class="font-semibold text-lg">{{ referral_count }}</div>
            </div>
            <div class="bg-primary/30 p-3 rounded-lg text-center">
                <div class="text-xs opacity-70 mb-1">Получено токенов</div>
                <div class="font-semibold text-lg">{{ referral_rewards }} CF</div>
            </div>
        </div>
    </div>

    <div class="card p-4 mb-6">
        <h2 class="text-lg font-semibold mb-3">Ваша реферальная ссылка</h2>
        <div class="bg-primary/30 p-3 rounded-lg mb-4">
            <div class="text-sm break-all" id="ref-link">{{ referral_link }}</div>
        </div>
        <button id="copy-btn" class="w-full py-2 bg-secondary hover:bg-secondary/80 transition text-center rounded-lg">
            Копировать ссылку
        </button>
    </div>

    <div class="card p-4 mb-6">
        <h2 class="text-lg font-semibold mb-3">О программе</h2>
        <div class="space-y-4">
            <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-accent font-semibold">1</span>
                </div>
                <div>
                    <p class="text-sm">Приглашайте друзей по вашей реферальной ссылке</p>
                </div>
            </div>
            <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-accent font-semibold">2</span>
                </div>
                <div>
                    <p class="text-sm">Получайте 10% от всех CF токенов, заработанных вашими рефералами</p>
                </div>
            </div>
            <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-accent font-semibold">3</span>
                </div>
                <div>
                    <p class="text-sm">Получайте 5% от всех TON и NOT токенов, заработанных рефералами</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card p-4 mb-6">
        <h2 class="text-lg font-semibold mb-3">Уровни программы</h2>
        <div class="space-y-3">
            <div class="bg-primary/30 p-3 rounded-lg flex items-center justify-between">
                <div>
                    <div class="font-semibold">Уровень 1</div>
                    <div class="text-xs opacity-70">Ваши прямые рефералы</div>
                </div>
                <div class="text-right">
                    <div class="font-semibold">10% CF</div>
                    <div class="text-xs opacity-70">5% TON / NOT</div>
                </div>
            </div>
            <div class="bg-primary/20 p-3 rounded-lg flex items-center justify-between">
                <div>
                    <div class="font-semibold">Уровень 2</div>
                    <div class="text-xs opacity-70">Рефералы ваших рефералов</div>
                </div>
                <div class="text-right">
                    <div class="font-semibold">5% CF</div>
                    <div class="text-xs opacity-70">2% TON / NOT</div>
                </div>
            </div>
            <div class="bg-primary/10 p-3 rounded-lg flex items-center justify-between">
                <div>
                    <div class="font-semibold">Уровень 3</div>
                    <div class="text-xs opacity-70">Рефералы рефералов ваших рефералов</div>
                </div>
                <div class="text-right">
                    <div class="font-semibold">2% CF</div>
                    <div class="text-xs opacity-70">1% TON / NOT</div>
                </div>
            </div>
        </div>
    </div>

    <div class="card p-4">
        <h2 class="text-lg font-semibold mb-3">Ваши рефералы</h2>
        {% if referrals %}
        <div class="space-y-2">
            {% for referral in referrals %}
            <div class="bg-primary/20 p-3 rounded-lg flex justify-between items-center">
                <div>
                    <div class="font-semibold">{{ referral.user.username }}</div>
                    <div class="text-xs opacity-70">Присоединился: {{ referral.created_at|date:"d.m.Y" }}</div>
                </div>
                <div class="text-right">
                    <div class="font-semibold">+{{ referral.total_reward }} CF</div>
                    <div class="text-xs opacity-70">Уровень {{ referral.level }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-primary/20 p-6 rounded-lg text-center">
            <p class="mb-3">У вас пока нет рефералов</p>
            <p class="text-sm opacity-70">Поделитесь своей реферальной ссылкой с друзьями</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const copyBtn = document.getElementById('copy-btn');
        const refLink = document.getElementById('ref-link');
        copyBtn.addEventListener('click', function() {
            const tempInput = document.createElement('input');
            tempInput.value = refLink.textContent;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'Скопировано!';
            copyBtn.classList.add('bg-accent', 'text-dark');
            copyBtn.classList.remove('bg-secondary');
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.classList.remove('bg-accent', 'text-dark');
                copyBtn.classList.add('bg-secondary');
            }, 2000);
        });
    });
</script>
{% endblock %}
