{% extends 'base.html' %}
{% load static %}

{% block title %}Oxiri P2P - Реферальная{% endblock %}

{% block head %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/modern-referral.css' %}">
{% endblock %}

{% block content %}
<div class="referral-container">
    <div class="referral-header">
        <div class="referral-header-content">
            <h1 class="referral-title">Реферальная программа</h1>
            <div class="referral-subtitle">{{ main_stats|safe }}</div>
            <div class="referral-subtitle">{{ motivation_text|safe }}</div>
        </div>
    </div>

    <div class="referral-stats">
        <div class="stat-card">
            <div class="stat-value">{{ referral_count }}</div>
            <div class="stat-label">Приглашено друзей</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ referral_rewards }}</div>
            <div class="stat-label">Получено CF токенов</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">3</div>
            <div class="stat-label">Уровня вознаграждения</div>
        </div>
    </div>

    <div class="referral-link-card">
        <h2 class="referral-link-title">Ваша реферальная ссылка</h2>
        <div class="referral-code-container">
            {{ referral_code }}
        </div>
        <div class="referral-link" id="ref-link">
            {{ referral_link }}
        </div>
        <div class="referral-buttons">
            <button id="copy-btn" class="referral-button primary">
                Копировать ссылку
            </button>
            <a href="https://t.me/share/url?url={{ referral_link }}" target="_blank" class="referral-button secondary">
                Поделиться
            </a>
        </div>
    </div>

    <div class="referral-link-card">
        <h2 class="referral-link-title">О программе</h2>
        <div class="space-y-4">
            <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-accent font-semibold">1</span>
                </div>
                <div>
                    <p class="text-sm">Приглашайте друзей по вашей реферальной ссылке</p>
                </div>
            </div>
            <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-accent font-semibold">2</span>
                </div>
                <div>
                    <p class="text-sm">Получайте 10% от всех CF токенов, заработанных вашими рефералами</p>
                </div>
            </div>
            <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-accent/20 flex items-center justify-center mr-3 flex-shrink-0">
                    <span class="text-accent font-semibold">3</span>
                </div>
                <div>
                    <p class="text-sm">Получайте 5% от всех TON и NOT токенов, заработанных рефералами</p>
                </div>
            </div>
        </div>
    </div>

    <div class="referral-levels">
        <h2 class="referral-levels-title">Уровни программы</h2>
        <div class="levels-grid">
            <div class="level-card active">
                <div class="level-number">Уровень 1</div>
                <div class="level-title">Прямые рефералы</div>
                <div class="level-requirement">Ваши прямые приглашения</div>
                <div class="level-reward">10% CF</div>
                <div class="level-reward">5% TON / NOT</div>
            </div>
            <div class="level-card">
                <div class="level-number">Уровень 2</div>
                <div class="level-title">Рефералы 2-го уровня</div>
                <div class="level-requirement">Рефералы ваших рефералов</div>
                <div class="level-reward">5% CF</div>
                <div class="level-reward">2% TON / NOT</div>
            </div>
            <div class="level-card">
                <div class="level-number">Уровень 3</div>
                <div class="level-title">Рефералы 3-го уровня</div>
                <div class="level-requirement">Рефералы рефералов ваших рефералов</div>
                <div class="level-reward">2% CF</div>
                <div class="level-reward">1% TON / NOT</div>
            </div>
        </div>
    </div>

    <div class="referrals-list">
        <h2 class="referrals-list-title">Ваши рефералы</h2>
        {% if referrals %}
        <table class="referral-table">
            <thead>
                <tr>
                    <th>Пользователь</th>
                    <th>Дата</th>
                    <th>Доход</th>
                    <th>Уровень</th>
                    <th>Статус</th>
                </tr>
            </thead>
            <tbody>
                {% for referral in referrals %}
                <tr>
                    <td>
                        <div class="referral-user">
                            <div class="referral-user-info">
                                <span class="referral-username">{{ referral.user.username }}</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="referral-date">{{ referral.created_at|date:"d.m.Y" }}</div>
                    </td>
                    <td>
                        <div class="referral-income">+{{ referral.total_reward }} CF</div>
                    </td>
                    <td>
                        <div>{{ referral.level }}</div>
                    </td>
                    <td>
                        <span class="referral-status active">Активен</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="bg-primary/20 p-6 rounded-lg text-center">
            <p class="mb-3">У вас пока нет рефералов</p>
            <p class="text-sm opacity-70">Поделитесь своей реферальной ссылкой с друзьями</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const copyBtn = document.getElementById('copy-btn');
        const refLink = document.getElementById('ref-link');
        copyBtn.addEventListener('click', function() {
            const tempInput = document.createElement('input');
            tempInput.value = refLink.textContent.trim();
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'Скопировано!';
            copyBtn.classList.add('copied');
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.classList.remove('copied');
            }, 2000);
        });
    });
</script>
{% endblock %}
