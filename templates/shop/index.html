{% extends 'base.html' %}
{% load static %}

{% block title %}Oxiri P2P — Магазин{% endblock %}

{% block content %}
{% if messages %}
  <div class="flex flex-col gap-2 items-center mb-5">
    {% for message in messages %}
      {% if message.tags == "success" %}
        <div class="w-full max-w-md rounded-xl px-4 py-3 bg-green-500/90 text-white shadow text-center font-semibold tracking-wide transition-all">
          <i class="fa fa-check-circle mr-2"></i>{{ message }}
        </div>
      {% elif message.tags == "error" or message.tags == "danger" %}
        <div class="w-full max-w-md rounded-xl px-4 py-3 bg-red-500/90 text-white shadow text-center font-semibold tracking-wide transition-all">
          <i class="fa fa-times-circle mr-2"></i>{{ message }}
        </div>
      {% elif message.tags == "warning" %}
        <div class="w-full max-w-md rounded-xl px-4 py-3 bg-yellow-400/90 text-black shadow text-center font-semibold tracking-wide transition-all">
          <i class="fa fa-exclamation-triangle mr-2"></i>{{ message }}
        </div>
      {% else %}
        <div class="w-full max-w-md rounded-xl px-4 py-3 bg-blue-500/80 text-white shadow text-center font-semibold tracking-wide transition-all">
          <i class="fa fa-info-circle mr-2"></i>{{ message }}
        </div>
      {% endif %}
    {% endfor %}
  </div>
{% endif %}

<div class="mb-4 text-center">
  Баланс: <b>{{ user.ton_balance }}</b> TON
</div>

  <div class="grid gap-6">
    {% for item in items %}
    <div class="card p-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="{% static item.image %}" alt="{{ item.name }}" class="h-10 w-10">
        <div>
          <div class="font-semibold">{{ item.name }}</div>
          {% if item.duration %}
            <div class="text-xs opacity-60">Срок: {{ item.duration }} ч.</div>
          {% endif %}
          <div class="text-xs opacity-60">
            Цена: {{ item.price }} {{ item.price_token_type }}
          </div>
        </div>
      </div>
      <form method="post" action="{% url 'shop:buy_shop_item' item.id %}">
        {% csrf_token %}
        <button type="submit" class="bg-blue-500 text-white rounded-full px-5 py-2 font-semibold">
          Купить
        </button>
      </form>
    </div>
    {% endfor %}
    <!-- Ветки/Улучшения (instant товар) -->
    <div class="card p-4 flex flex-col gap-3 items-center">
      <div class="flex items-center gap-3 mb-2">
        <img src="{% static 'images/tree_1.png' %}" alt="Ветка" class="h-10 w-10">
        <div class="font-semibold">Ветки / Улучшение / Дерево</div>
      </div>
      <form action="{% url 'shop:buy_branches' %}" method="post" class="flex items-center gap-2">
  {% csrf_token %}
  <input
    type="number"
    name="quantity"
    min="1"
    max="100"
    value="1"
    style="width: 60px; background: #eef4ff; color: #222; border: 1px solid #bcd;"
    class="rounded-lg px-2 py-1 text-center"
    placeholder="Кол-во"
    required
  >
  <button type="submit" class="bg-blue-500 text-white rounded-full px-5 py-2 font-semibold">
    Купить ветки
  </button>
</form>

    </div>
  </div>

  <h2 class="text-xl font-bold mt-10 mb-4 text-center">Мой инвентарь</h2>
  <div class="grid gap-3">
    {% for purchase in user.purchases.all %}
      <div class="card p-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="{% static purchase.item.image %}" alt="{{ purchase.item.name }}" class="h-8 w-8">
          <div>
            <div class="font-semibold">{{ purchase.item.name }}</div>
            {% if purchase.item.duration %}
              <div class="text-xs opacity-60">Срок: {{ purchase.item.duration }} ч.</div>
            {% endif %}
          </div>
        </div>
        <form method="post" action="{% url 'use_shop_item' purchase.id %}">
          {% csrf_token %}
          <button type="submit" class="bg-green-500 text-white rounded-full px-4 py-1 font-semibold">Использовать</button>
        </form>
      </div>
    {% empty %}
      <div class="text-center text-gray-500">Нет купленных предметов.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
